<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>ProductServiceIntegrationTest.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">examen (May 9, 2019 6:04:33 PM)</a> &gt; <a href="../../index.html" class="el_group">examen</a> &gt; <a href="../index.html" class="el_bundle">src/test/java</a> &gt; <a href="index.source.html" class="el_package">ar.com.flexibility.examen.domain.service</a> &gt; <span class="el_source">ProductServiceIntegrationTest.java</span></div><h1>ProductServiceIntegrationTest.java</h1><pre class="source lang-java linenums">package ar.com.flexibility.examen.domain.service;

import ar.com.flexibility.examen.Application;
import ar.com.flexibility.examen.domain.exception.GenericException;
import ar.com.flexibility.examen.domain.model.Product;
import ar.com.flexibility.examen.domain.service.impl.ProductServiceImpl;
import javassist.NotFoundException;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.math.BigDecimal;
import java.util.List;

import static org.junit.Assert.*;

@RunWith(SpringRunner.class)
@SpringBootTest(classes = Application.class)
<span class="fc" id="L22">public class ProductServiceIntegrationTest</span>
{
	@Autowired
	private ProductServiceImpl productService;

	private static long COUNT;
	private static long ID_EXIST_IN_DB;
	private static long ID_NOT_EXIST_IN_DB;

	@Before
	public void setUp() throws GenericException 
	{
<span class="fc" id="L34">		productService.deleteAll();</span>

<span class="fc" id="L36">		Product product = new Product();</span>
<span class="fc" id="L37">		product.setDescription(&quot;first product&quot;);</span>
<span class="fc" id="L38">		product.setPrice(new BigDecimal(2.50));</span>

<span class="fc" id="L40">		productService.add(product);</span>
		
<span class="fc" id="L42">		List&lt;Product&gt; productList = productService.findAll();</span>

<span class="fc" id="L44">		COUNT = productList.size();</span>
<span class="fc" id="L45">		ID_EXIST_IN_DB = productList.get((int) COUNT - 1).getId();</span>
<span class="fc" id="L46">		ID_NOT_EXIST_IN_DB = ID_EXIST_IN_DB + 1;</span>
<span class="fc" id="L47">	}</span>

	@Test
	public void testFindAll()
	{
		// given

		// when
<span class="fc" id="L55">		List&lt;Product&gt; products = null;</span>
		try
		{
<span class="fc" id="L58">			products = productService.findAll();</span>
<span class="fc" id="L59">		}</span>
<span class="nc" id="L60">		catch (GenericException e)</span>
		{
<span class="nc" id="L62">			e.printStackTrace();</span>
		}

		// then
<span class="fc" id="L66">		assertNotNull(products);</span>
<span class="fc" id="L67">		assertFalse(products.isEmpty());</span>
<span class="fc" id="L68">		assertEquals(COUNT, products.size());</span>
<span class="fc" id="L69">	}</span>

	@Test
	public void testFindOne()
	{
		// given
<span class="fc" id="L75">		Product p1 = null;</span>
<span class="fc" id="L76">		Product p2 = null;</span>

		// when
		try
		{
<span class="fc" id="L81">			p1 = productService.findOne(ID_EXIST_IN_DB);</span>
<span class="nc" id="L82">			p2 = productService.findOne(ID_NOT_EXIST_IN_DB);</span>
<span class="nc" id="L83">		}</span>
<span class="fc" id="L84">		catch (NotFoundException e)</span>
		{
<span class="fc" id="L86">			e.printStackTrace();</span>
		}
<span class="nc" id="L88">		catch (GenericException e)</span>
		{
<span class="nc" id="L90">			e.printStackTrace();</span>
		}

		// then
<span class="fc" id="L94">		assertNotNull(p1);</span>
<span class="fc" id="L95">		assertEquals(ID_EXIST_IN_DB, (long) p1.getId());</span>
<span class="fc" id="L96">		assertNull(p2);</span>
<span class="fc" id="L97">	}</span>

	@Test
	public void testAddOk()
	{
		// given
<span class="fc" id="L103">		Product productToAdd = new Product();</span>
<span class="fc" id="L104">		productToAdd.setDescription(&quot;prueba add&quot;);</span>
<span class="fc" id="L105">		productToAdd.setPrice(new BigDecimal(100.00));</span>

		// when
<span class="fc" id="L108">		Product productAdded = null;</span>
		try
		{
<span class="fc" id="L111">			productAdded = productService.add(productToAdd);</span>
<span class="fc" id="L112">		}</span>
<span class="nc" id="L113">		catch (GenericException e)</span>
		{
<span class="nc" id="L115">			e.printStackTrace();</span>
		}

		// then
<span class="fc" id="L119">		assertEquals(ID_EXIST_IN_DB + 1, (long) productAdded.getId());</span>
<span class="fc" id="L120">		assertEquals(productToAdd.getDescription(), productAdded.getDescription());</span>
<span class="fc" id="L121">		assertEquals(productToAdd.getPrice(), productAdded.getPrice());</span>
<span class="fc" id="L122">	}</span>

	@Test
	public void testUpdateOk()
	{
		// given
<span class="fc" id="L128">		Product productOriginal = null;</span>
		try
		{
			// when
<span class="fc" id="L132">			productOriginal = productService.findOne(ID_EXIST_IN_DB);</span>
<span class="fc" id="L133">		}</span>
<span class="nc" id="L134">		catch (NotFoundException e)</span>
		{
<span class="nc" id="L136">			e.printStackTrace();</span>
		}
<span class="nc" id="L138">		catch (GenericException e)</span>
		{
<span class="nc" id="L140">			e.printStackTrace();</span>
		}
		// then
<span class="fc" id="L143">		assertNotNull(productOriginal);</span>

		// given
<span class="fc" id="L146">		Product productToUse = new Product();</span>
<span class="fc" id="L147">		productToUse.setId(ID_EXIST_IN_DB);</span>
<span class="fc" id="L148">		productToUse.setDescription(&quot;prueba update&quot;);</span>

<span class="fc" id="L150">		Product productUpdated = null;</span>
		try
		{
			// when
<span class="fc" id="L154">			productUpdated = productService.update(productToUse);</span>
<span class="fc" id="L155">		}</span>
<span class="nc" id="L156">		catch (NotFoundException e)</span>
		{
<span class="nc" id="L158">			e.printStackTrace();</span>
		}
<span class="nc" id="L160">		catch (GenericException e)</span>
		{
<span class="nc" id="L162">			e.printStackTrace();</span>
		}

		// then
<span class="fc" id="L166">		assertNotNull(productUpdated);</span>
<span class="fc" id="L167">		assertEquals(productUpdated, productToUse);</span>
<span class="fc" id="L168">		assertNotEquals(productUpdated, productOriginal);</span>
<span class="fc" id="L169">	}</span>

	@Test
	public void testUpdateErrorIdNotFound()
	{
		// given
<span class="fc" id="L175">		Product productToUse = new Product();</span>
<span class="fc" id="L176">		productToUse.setId(ID_NOT_EXIST_IN_DB);</span>

<span class="fc" id="L178">		Product productUpdated = new Product();</span>
		try
		{
			// when
<span class="nc" id="L182">			productUpdated = productService.update(productToUse);</span>
<span class="nc" id="L183">		}</span>
<span class="fc" id="L184">		catch (NotFoundException e)</span>
		{
<span class="fc" id="L186">			e.printStackTrace();</span>
		}
<span class="nc" id="L188">		catch (GenericException e)</span>
		{
<span class="nc" id="L190">			e.printStackTrace();</span>
		}

		// then
<span class="fc" id="L194">		assertNull(productUpdated.getId());</span>
<span class="fc" id="L195">	}</span>

	@Test
	public void testUpdateErrorWithoutChanges()
	{
		// given
<span class="fc" id="L201">		Product productOriginal = null;</span>
		try
		{
			// when
<span class="fc" id="L205">			productOriginal = productService.findOne(ID_EXIST_IN_DB);</span>
<span class="fc" id="L206">		}</span>
<span class="nc" id="L207">		catch (NotFoundException e)</span>
		{
<span class="nc" id="L209">			e.printStackTrace();</span>
		}
<span class="nc" id="L211">		catch (GenericException e)</span>
		{
<span class="nc" id="L213">			e.printStackTrace();</span>
		}
		// then
<span class="fc" id="L216">		assertNotNull(productOriginal);</span>

		// given
<span class="fc" id="L219">		Product productToUse = new Product();</span>
<span class="fc" id="L220">		productToUse.setId(productOriginal.getId());</span>
<span class="fc" id="L221">		productToUse.setDescription(productOriginal.getDescription());</span>
<span class="fc" id="L222">		productToUse.setPrice(productOriginal.getPrice());</span>

		// when
<span class="fc" id="L225">		Product productUpdated = null;</span>
		try
		{
<span class="nc" id="L228">			productUpdated = productService.update(productToUse);</span>
<span class="nc" id="L229">		}</span>
<span class="nc" id="L230">		catch (NotFoundException e)</span>
		{
<span class="nc" id="L232">			e.printStackTrace();</span>
		}
<span class="fc" id="L234">		catch (GenericException e)</span>
		{
<span class="fc" id="L236">			e.printStackTrace();</span>
		}

		// then
<span class="fc" id="L240">		assertNull(productUpdated);</span>
<span class="fc" id="L241">		assertEquals(productToUse, productOriginal);</span>
<span class="fc" id="L242">	}</span>

	@Test
	public void testDeleteOk()
	{

<span class="fc" id="L248">		Product product = null;</span>
		try
		{
			// given
<span class="fc" id="L252">			assertNotNull(productService.findOne(ID_EXIST_IN_DB));</span>
			// when
<span class="fc" id="L254">			productService.delete(ID_EXIST_IN_DB);</span>
<span class="nc" id="L255">			product = productService.findOne(ID_EXIST_IN_DB);</span>

<span class="nc" id="L257">		}</span>
<span class="fc" id="L258">		catch (NotFoundException e)</span>
		{
<span class="fc" id="L260">			e.printStackTrace();</span>
		}
<span class="nc" id="L262">		catch (GenericException e)</span>
		{
<span class="nc" id="L264">			e.printStackTrace();</span>
		}
		// then
<span class="fc" id="L267">		assertNull(product);</span>
<span class="fc" id="L268">	}</span>

	@Test
	public void testDeleteIdNotFound()
	{
		// given
<span class="fc" id="L274">		Product product = null;</span>
		try
		{
			// when
<span class="nc" id="L278">			productService.delete(ID_NOT_EXIST_IN_DB);</span>
<span class="nc" id="L279">			product = productService.findOne(ID_NOT_EXIST_IN_DB);</span>
<span class="nc" id="L280">		}</span>
<span class="fc" id="L281">		catch (NotFoundException e)</span>
		{
<span class="fc" id="L283">			e.printStackTrace();</span>
		}
<span class="nc" id="L285">		catch (GenericException e)</span>
		{
<span class="nc" id="L287">			e.printStackTrace();</span>
		}
		// then
<span class="fc" id="L290">		assertNull(product);</span>
<span class="fc" id="L291">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>examen (May 9, 2019 6:04:33 PM)</div></body></html>